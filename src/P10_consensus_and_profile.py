import numpy as np
from P05_computing_GC_content import extract_fasta_sequences


def check_dna_sequence_lengths(dna_sequences):
    dna_sequences_dict = extract_fasta_sequences(dna_sequences)
    for dna_sequence in dna_sequences_dict.values():
        if len(dna_sequence) != len(next(iter(dna_sequences_dict.values()))):
            raise None
    return True


def create_consensus_string_and_matrix(dna_sequences):
    dna_sequences_dict = extract_fasta_sequences(dna_sequences)

    check_valid_seq_length = check_dna_sequence_lengths(dna_sequences)
    if not check_valid_seq_length:
        raise ValueError("All DNA sequences must be of the same length.")

    raw_matrix = np.array([])
    for dna_sequence in dna_sequences_dict.values():
        raw_matrix = np.vstack((raw_matrix, np.array(list(dna_sequence)))) if raw_matrix.size else np.array(list(dna_sequence))

    profile_matrix = {'A': [], 'C': [], 'G': [], 'T': []}
    consensus_string = ""

    i = 0
    while i < raw_matrix.shape[1]:
        a_count = c_count = g_count = t_count = 0
        max_count = 0

        for nucleotide in raw_matrix[:, i]:
            match nucleotide:
                case "A":
                    a_count += 1
                case "C":
                    c_count += 1
                case "G":
                    g_count += 1
                case "T":
                    t_count += 1

        profile_matrix['A'].append(a_count)
        profile_matrix['C'].append(c_count)
        profile_matrix['G'].append(g_count)
        profile_matrix['T'].append(t_count)

        max_count = max(a_count, c_count, g_count, t_count)
        match max_count:
            case _ if max_count == a_count:
                consensus_string += "A"
            case _ if max_count == c_count:
                consensus_string += "C"
            case _ if max_count == g_count:
                consensus_string += "G"
            case _ if max_count == t_count:
                consensus_string += "T"
        i += 1

    return consensus_string, profile_matrix


if __name__ == "__main__":
    sample_dna_sequences = """>Rosalind_3388
GTTACCTATGGTGTTATACCAATAGAAACCGCGCACGGTGTGAGAGCCACTTCGCTCCGG
TGTATGTGGAGTTAATACTCGAAAGGCCACAGTAATAACGATGAGGATGAGACGCTTTAG
AGTATATCTTACCTAAAGCCCCTGTCGCCCTTCTTCTACTACCAAACAGCGCTTTTTCAC
GACCTTTCTGCCCCCTGCTCGGGAATGGGGAGGTGCCACTCGCGGCTAGGGGCATGGAGT
TTCACACACTTAACTTGGCGTAGATTCCCGTGATTATCCATCACCAAGCGCGGAAGTCGA
ACAATCGCAAGTATTTATAATCAGGCGAAGGCTGACTCTACGCAAGCTCACAGAAGGACA
AGTATTTTATGTTGCGCTCTAGCCGCAGGAACTTTTGTCTTTCATGTAAGGCATCTCTGA
ATTAGGCTGCGTGTTCTTGAGGGTTGACTCGCCTGGTTGAGTATGCTCTGTCTTTATCTT
GATGTTGTAGGCGTAGTCGTGTCCACACCTCAACTACTTGAGTAGGCGACCTGGGTGCAG
GAACTGCTAGGCTCGGGGGCTCAGGCGCTGGCTTGTTACACCAGGCTATAGACAGTTCAC
CCCTGGCAAGTAGCAATTATATCCGAGGAATTGAACAACGACCCGGCTAGACCTGCCAAG
TCGACGAGGGCACCCTATTCGGAACCAGGACACATCGCTTTACATCGCATGCCCGCGCAT
ACGATCCCCTCTGATTCCACAGCTACCCAGGTTGCAGTACGTTGTTTGTCTCGATTCCTC
GCCGATCCCGACCCTAATAGCCCACTGGAATCTTAGGGCCATGAGTCCGTGAAAAGATCA
AATACGGACGGAGTCAGCTCATCGCCGATGGCGGCCCGCGGACATACCCCGCCAAATGAG
CTAATTTCAGGTT
>Rosalind_5585
TAGTGTAACACAAGCTTCAGTTGTGATTGCGTAAGGGTCCGTCGTTTGAACAGACTTAGT
GTGCGAGTGCGTCCGGTGTTTGTGCGATTTCGACCTTCTACTGCGCTTACGTGCGTGGAT
CACAGCACGCTGCAGTAGTGTGGCGAGGGCCTCAAAGTCTCATGGTACTCTTCGTTGAGG
CACGTGCGTTTCCTGGTAGCAGCGTCTTCACTTGGTCTCAGCCTAGATTCAGATGCGGAT
GAGTGGGCTCATGTACTTGCAGATTCGTTCTACCCTGACCCATTCCACGCGCGGACCGTA
TTCTTTCCAACTCGATCGCACAAAAATACGTGGGTAACGGTGGAGAGACGCTACTGGTGA
CGTAATCACATAGATATTGTGATGCAGCTTCAGTTGCATGTGGTGAGGGAGCTTGGATTC
TCTCTCGGTCTACGCTGCCCGAGTAGCTAACCTAACAATGAGATTTCGTCGAAACTGTTC
TACTTGGACACACTATTATTCACGACAATCGATTCTGTAAATGGAGGAGCCCACCTATGG
AGAGTCGTGTCGTGTACAACTCCTACGTGCCGTGACGCCGCGGCTCGGTTTTGTGGAGGT
AACCGCGCTACTGAAAGAAATCATCTAGGGTCGATGACAAATCTGCGCAACTAAAACGAA
GCCTCTGTCATCATCGCGGAGAGATCGATCCGAGGTCCTGAGGCTTTCATATCTCGTGCA
ACCGCCAGAGCGGCAAGTCACAGGGAATGAGAAACCTGGATCGGTTTTGAATTTGTCACG
CCCTACAGCCTGGCACCCTCATCACACCCGCCACGGCGCAACATGAGGAGGCCTTAATCC
CATAATAGATTGATATGCGGTATTCGTCGATAAAAGGTCATGGTACCTGCCAGCACATGG
CAAACCGGGTGAC
>Rosalind_2952
TCGCACATAATAAGCACACGGCTGGTCTTTCACCGCCTTAAAAACAAAAAGACCGGCAAG
ATGACCCATTTTTCCCCCGCAGCCTGTTAGGTATTAGGATGGTGAGGACAGATTCGTACT
GCCTATCAAGTAGGTGTGTGTGCGATCGCGTATTCACGTAAACGTATTGGTATCTTAAGA
ATTGTATCTCAGGGAGGCAATCCGCTCTATTGCAGTCCAGGCCATATTTTATCCCCTAGA
CGTGTGAGATTCCGCGCTGGCCCTCGACAAGCTTCGAGTTATCCCTTTGAGGGCTATGGA
TGCTCCTTCTCACGGAGAAACCACAAGGTAACTCTTATGCATGCAACCGTATCTCGAGTC
CAGCCCGTAAACTATCGCACCGCTACACGACGAGAGGTAAAGCTGGCTTAGACAATCCCT
AACTTACTGGTTGACGACACGATCCGGAAAAACTGCCGTTCAAAGTCGCGTTGAAATTTC
AAAAGGCTATTCATTCTGAGAGCGAATGCAGCCCACTTCACTCAGGTGTCCGCCAAGGTC
GTGTGCCCATAGGTGTCGTGCAGCCCAAAACCCCCAATTTTCAACTCCTGCTGGTGAATG
ACCGGCGGATGTTCTTAGGGCGGCGCCAGGCTAGCAACAATTGTTCAGCGAGCACATGAG
ATAGATTGAACCTTAATAGCCCCAGTTCAGTTGAAGCCAGGTGGGTCACGTGCCGATAGG
TGTTCGTAAGCCTCACCTCCACAAACGATATGCGTCTACCAAAAGATCTACACGGGTAGG
GCGTTATAGCAATAGCTTTTCGAACCCAAGCATCTCCATATAAAATGTCAGTAACCTGAG
TGCTTCCCATGCTGACGGCGGGTTCGCCCTGGCTTACGATGCTGTACATTTGGGTTCCTG
AAGTGCTTGGTTT
>Rosalind_7898
AACTAGTCTAGATCAGGAATTCCCCGACTTGGTCTCTGAAGTGTGTATATTGGCCGGCTG
CGGCTGGATAGGATGATATGTATGATTTTCTGCAAACCGTGGACCATGCAGTCGCCTCTA
ACAATCTCCAGTACAGAACCAATACTAGCGACGTTAGTCAGTCCCATATTCTCATCTGTA
ATCGTGCTTGCCAGCCGTGCCTCACCAGACAGCTATTCCATATTAGTACGCTGAACCGAT
ACCTTGTGTCGCTCATAAGGTACTGGGTCAAGACACAAACAAATATTATGACGGTTCTTA
TGTGATGAATAACGCTTTAGTACCTACGGCACGACTATCCAGGAATAGCCTGAATAACAG
AAATTGACCATTCCGCATGCCTCTCCAATGAACATAACACACTACAGCTTATGAGTTATT
TTTATTACATCTCCGTATGTACGCGCGCATATAGTTGTGAGTATTCCCGATCGTCTTAGG
AATTTACCCAGACCTGGGGCCAATAGCTCCGACACGGTATGGACATCGGTAGGGGAGCTC
TACTAAAAGCTAGGAATAGCGGCGTTGTGTCCCCTCTTGTTACGTTCAGAGCGTTGTTAG
GCCGTCACTTTCATATGAAGATCGCGCGTGAAGGGCGTCAGTCACGGTAAGAGAGTCATC
TTCGTCAAGCGTATTTGAAACTCCCTAGGAAGCTAGGTTTTTAGCATCTGAGGCACACGT
TTACTCCCACTCATCAGCGAAAGTTACCCGAGTCGGGGATCCAAACGTACTTGTATAGTG
GGCACCAGTTAATTTGCGCCGGCCGCAAGCTAAGATAAACCTCCATACGTATAGTAAGTA
ACTCTATTCCTGAAAATCTGTGGGTAAGGGAGCCATACCGTATTTTCAAAGCTCTTATTC
CGATCGTCGGAAG
>Rosalind_6725
GCACCGCGCTAAGGGGGTGAACAGAAGCAAGCGTTCGCTAATACGAACTGCAATCCGACG
TGGGGCCTTTTCTATTTCGAAACTATCGGAAAGATATTGCACTTTGGCGCGGGGAAGACT
TTAACCTTGTAACGCGCCGTGGTACAGCTGGACGGCGATGTCCTTCCACTACCGTATCAC
GTCCTGCTAATCGCATGACGCCTTCACTGGTTGCCCGTTAGATGCCATCACGAGGGCCAA
AGTCAATTCGAGGGACGGCCCGAATGCGCCGATTAGCGAGTTCACCGGAGTTTATCGCCA
TTTAGTCCTCCCTACATTGACTGCCTAGAATGGAAGAACGGTATTTGAACCGCATGTTCC
TACCCTTGTGGTGCATCTCAAATCCTGCATTAAGCCGAACTTCCTAGTTGACCTATCTTA
CGCCAGTCTCCTTTCTTTACCCCGGCATATTCTAAGTTATCTACGCTTTAAGATTCCGCC
CTGATCACGGACTTACATGGAGAACTTGGCTTTTAGTAACTGTAATATTGAATATCCCGC
ACCTGCGGTCGAATAGTTTCCAGCTGGGCATATCAGCCGTCGTGACGGGAATAGTCACTG
ACACCGACCATTGTTCCACCCTCTTGGACGCGGCTAATCCACTACGGAGTAATTGACGCC
TGCATACATCAGGCCTGTGCTCGCATGCGCCCCGATTTAAAGCGATTGAGAAGTAGCTCG
GACCGCGGTTACGTATTGAGACCAGTCATGGGGCCACCTACTTGGCTCGCAAGTCGTTAA
CTACATAACGGCAACCTAAATCAGGACGGTTGCACCACGAGAAGCATTAAAGGATGGACC
TCCGGTTGCCTGGTTGAGAGGACGTAAAATTGCATTCCGTCTAAAGCAAAGGCTGCAGTT
ACTAACTCGGACA
>Rosalind_6261
GTCGACTCAGCGTCGACAACATCCGCTGGGCCTGGTGCTCAATTATATCTATGTGACCCA
GCTCTAACACATATTTCGTATAAAACAAAAAAATGTTACGATCATTAATCAGTGTAGCAT
CGCACATGAGTAGAAATGCAACAGGGAATAGAGAGTTTCTTGGCACGGCAGTGGGAGTGG
GCAACATCTAAGGCCCTTATGTACGGATGCCTCTACGTGATATATGAGTGGGCTCGTCGG
TCGAGGCGTCTGGTGTAGATGCTAGAAACCTCAATGGAGATCTTAGCCTGTTTCATCACC
GTCACACATTGCTCATGCGCTGCTGGTTTATCGCTTGATCCTTTTCACTCAATGCAGCCA
TTAGGAAGCAGGCGCGTTTCCGGGTTCTTCTTAACGACCAGGTGTTCTTAGATCAATGGC
ATCGATAAAGCATAACGGAGTCGTCGTCCTAACTAGATGACTGGACGTTGGCGTGGGGAA
AACTTGTTAATGCAGAAATCCATGTTATAAACGCTGGTCGCGCCAGTCGTACATCCGGGC
ATGATGACCAGTAGCAGTTTACTTTCCGAGCCCATTCAGAGACCAGTGTCGATGTTCAGA
GACCAGCGTTATAAGTGTGGTCCCTTGGTGATCCGGCTGGATTTAGGTAACGTATGCAGG
GTCAAGACTGAATACTGAGTCAACGTACAAGGTGTTACTGCCGCGATCTGCAATGGATCC
ACAGTACAGTGGTCTCGGGGTCCTCATAATACTTACCGGAGCACGTCAGTGGCAGTTTTA
TGTATGGAGACTAAGTGATACATCGATCTTACTCTGATGTCTTGCCGACCCTACAATGCC
CTGCCCTCGCAATTTGACGTTGACAGATATATCGTATGGCCATACACTAGGGCAATCAAG
GAATAATCCATCC
>Rosalind_7287
AGTCGGTCTTGGGATAGACAGAAAGCGTGATGAAGTGCGTCCGCTCACGTTGGGCAGCTT
TAAGAGAGCATTGGTTATGCACTTTCCTATGCCCGGAGTCGGGAAGGACCCTGTGTCGTA
TGGGACTTGAGACGGGTAGAGGATTAGGGAGCCAGAGAAACGGCTACAGAGAGAAAAGGG
GGGACACAAACGGCTCCGCAGTCCAGATCACGTCCGGGCGGACTGTCTTATAGGGGTCGA
CTAGGTCATTAAGTATCGAACCGGATACGTAGGACAGGTGCTCGGCTTCATGAACAGCCT
GAGGCGGCATTGGATATCATGCCGACTCTCATGTCAGGTATATGTCGTAACGCGGATCTC
CGCCAGTATGAATAGGGCGCGCTTAGGGTTCCGAACAGAAACCCAGCCTTCTTCATAACG
ACTATGTTTACCTGGGAGGATAATACCGCCCGCTGCTAGCGGCGAGAGCATTTGGGGAAC
GGGAGCTATTACTACCGGCACTAGAGATTGACCCTATGGATGAGGCAGTGTTGGACAGTA
TTGTGTGTTTAAGAACCCCCCACTCCATCACGCAACGCCAAGGAAATGCTGAGGTACCTT
TGAATCCGATGGCTTACATGAAGGCGTAGGGAGAAAGGCCAACAGAAGCATCTCCACATA
TCTCGATAGCGAACGGTCTAGCTAGCTCTGCACCTAAAAATTGAAGCCCCACGTTCAAGC
TTGCGGGGCACTGAGGTACTATGCGGCGTCAGACGGTTACTGCTCCCCTAGCAGCAAGTC
CACCTATGTTATTAGCGAGAAGGATCTCAACCCTGGGCAGTTAATTAATTCGCGTTATGT
CCGTGTATCGTTCATAACACCTCGGGAGGTCTTCCGATCTAAGACGTCGTACGTGCCGCA
AAGCAGTGTACCA
>Rosalind_8744
TGTGACTTATCTAATTCCCCATCCCTGGGTGCGATGACTTGGCGTTAATTGCTAACATCA
TCGGATTTCCAAGTGCTCGCCCGTTGCGCGCGAAGTACTTAAGAGGCGTCCGGGCGAAAT
CAATCACACATGACATACGGGGCCGCTCGATTTGGTCAAGGTACACGTCGCGGTTCCCGG
TGACATCCGTCGTGCGTGGAAACCTTTCCCAAAGTCGCTCCTTCGTCACTATACTCACCT
TTCACTCTCAACAAGTGGCGAACCTACTGCGGATAATTGCCCCTACAGTGGCATTGTCAT
GGCACAGTGCGTCTTAAGTCCCCTCGAAACAGTACGGGAATTGACTATTCGCACGTCGTC
ACCCATGGAACCCGTCGGTTAACAATAATAAGTTAACAAGTCAGAAACGTCGGGCTGTGG
AAGTAGGGGATTGCACGCGGCTACACTCGCCCCGAGTTAGAACGACCTTGACCTACTACG
GTTTGGATCTTATGCGAGCCCTGTATGCCTTAGAGCTTGCAGACAGGCAGTTCTCAGCTC
TGACAGCACGGCCGCCTGCGGCATCGTTGTTAATTGTACACATCGGGGCATCGTTTGTGA
TAGTGATAAATGATAACTTGTGAAACCCCTGTCTATGCCGTTACTCTTGGCGTCGAACAC
TTAGTATGGGTAAGTGACATGTCTACGTGGCCTTCTTTTACCATAACGGTCTATGGCGAA
CTCTGGCGTCACAGTCACTAATGTACCAGTGTGAGGGCAACTCCCTAAGACCGCGGCTGA
CTGGGGGACACTAAAATCAGGGAGGCATGACTCTTGAGTAAGCGTAGTAGATAGCCCGTA
TCCGTCACCCGTTAAATTATCAGGACACATTTAATTCACCGGTAAACAACTACAGGATCA
GGAGATCTACCAG
>Rosalind_4362
TCGGTTGCCCTTTATCTCAGATTCGGCGCGAATTACGGCTCTATCCGCCGAGGACGCAGT
GATGGCATGTTTCAGAAGAGTTATGCTCTAGTCGAGATTATCAGAATGTAAATCAAGGCG
GAGACATCATGAAGCGACTTCTCAGACGTGGGTATTAATTCCCGTGCTCTTAGAAGGCAT
AATGTAAGTGGCTTGACTAGGTAATTGCGACTAACATCACTGCTAAATATAGAAGCGATT
TTTTGCCATTTGCCAAAATAATTGTGGGGGGTCCACTGAAAGTGGGACGGCTAGCATACT
TCAATACCCATCTTCGTGCCCAATCTAGCTTAATTCACGTCGTGCATGTCTGGTTATCGG
TTTGAAACCGTATTATATGTGTTATCACGGACAGCCTGACCCACCATCCGAAGAGCGTGG
TGCTGGAGACACCGATCCACAGGACGGCCCTCGGACATACATCGTCGCTCTGTATTCAGC
TATTAAGCCACAGAACCGGACTTTCCTATTTAAAACCGATATGAGGTGCGGCAGGAACTG
TTTTCATATCGGTTTCCCAAATTGGGCGCAGGTCTACCTGCATGCGTGTGGCGATTCAAT
CCTTGAGTCGGCTAGTCTCGATGCTCTCGACCCCGGGCGAGGGTCATATCGGATGCAGCT
TGTATATGAGTTGCTGCGTGGATACCTATCTGATCATTTGGCCAAGCAGGAAAAGGCTGG
CTGCTATGGCGTTCGACGCTCCTGTGGTGCATTAGCGGCCGAAGCAAAAAGTATGCCGAA
GGCCGTGCACCTTCGTCAAGAATGTCTGATGCATACGTGGAGCCGTTAACAGGGAGCCAA
GTGGCAACATGCCACGCGGTGCTAGGGTATATGAACCCCGTATAGTCTCGAGTCTTAACC
GTCCTCAGGTCAC
>Rosalind_7530
ATCTGAATCGCCCATCACTGTTCGGAACCACCCAGGTACAGCAGCCTAGGCGTCACTAAT
CCCTGCAGATAATGCTCACGGCTCGAAGTGTGCGGCCGCAGACCGTACTTCCCCTTTGAA
CGTAAACTCCCCGGTAGCTTTTTTGTTTGAAGCGCCCCTGGACATGACCAAATAAAAAAA
GGCCCCCATTGCAGCCATAATACACACTACCGGCCGTCTCTGCCCAAGTCATTTCTTGGA
GTGACTTGATCTCAACGCGTCATTACAGGCATGGCCGAGCTGTCCCCACCCGTATTGCGA
TAGTTATAGTCGGGACGCCCTAAATGCTAAGCGCCATAAGCCGCGACGGAGCGTAGCAAC
AGTTGCCCGTGATTTAAGTGGCTCTCTTGCCGAGGCGGGTAAAGGTAATCCCGTCACTAC
ATGCAGTCGCGTGCCGTCTGTCACACCGTAGACACCTTGACGAATATATCGAACAGTCGC
TGATAGCGTCGAACTGCGGCTGTTGGATATACGCCACCGTCTACTTCTCGTCCGTACGAG
GCGCCAAAGCCTGTACCTAGTACTGAATAGGCTTCGATTTGGTCGTCGTCCAACTGTGTT
CGTTCGATCTATTCATGTCAGAGGATGGCGGTGAGACCCTAGCTAGTTACATGCTGGGGA
ACCCAGCTAACTCTGACGCGAATTCATTTGTCAGAGGGTGGTGGGCCCATTACGGGGCCA
GCAGGACTGGTGGTGGCCGGTACTTAGCGTTCTATATACCTGGAGCTAAGTAGCAAATCT
CTCCAGGTGTGCGGCGACTGAGACACGCCAAAGCGGTGTACTTTTAATCTGACCACCACG
ACGAGGCGCGCTAGTCGTACTTACAGCAGCCCCGTGAGATACTGTCATGCCACCGACGTG
CCTTAAGAAAAGT
"""
    consensus_string, profile_matrix = create_consensus_string_and_matrix(sample_dna_sequences)

    print(consensus_string)
    for base, values in profile_matrix.items():
        print(f"{base}: {' '.join(map(str, values))}")
